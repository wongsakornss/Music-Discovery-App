{% extends 'base.html' %}
{% block content %}

<h2 class="text-xl font-semibold">โปรไฟล์: {{ username }}</h2>

<p class="text-white/60 text-sm mt-1">
  เพลย์ลิสต์ทั้งหมด: {{ playlists|length }}
  · จำนวนเพลงรวม: {{ total_tracks }}
  {% if stats %}
    · ศิลปินไม่ซ้ำ: {{ stats.unique_artists }}
    · Public: {{ stats.public_playlists }}
    · Private: {{ stats.private_playlists }}
  {% endif %}
</p>

{% if playlists and playlists|length > 0 %}
  <ul class="mt-5 grid gap-3 sm:grid-cols-2">
    {% for p in playlists %}
    <li class="rounded-2xl border border-white/10 bg-white/5 p-4 flex items-center justify-between gap-4">
      <div class="min-w-0">
        <div class="flex items-center gap-2">
          <div class="font-medium truncate">{{ p.name }}</div>
          {% if p.is_public %}
            <span class="text-[10px] px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-300 border border-emerald-500/30">Public</span>
          {% else %}
            <span class="text-[10px] px-2 py-0.5 rounded-full bg-white/10 text-white/70 border border-white/15">Private</span>
          {% endif %}
        </div>
        {% if p.description %}
          <div class="text-white/60 text-sm mt-0.5 truncate">{{ p.description }}</div>
        {% endif %}
        <div class="text-white/50 text-xs mt-1">
          เพลงทั้งหมด: {{ p.track_count or 0 }}
          {% if p.updated_at %} · อัปเดตล่าสุด: {{ p.updated_at }}{% endif %}
        </div>

        {% if p.share_token %}
          <div class="mt-1 text-xs">
            <span class="text-white/50">ลิงก์แชร์:</span>
            <a class="text-emerald-300 hover:underline break-all"
               href="{{ url_for('public_playlist_view', token=p.share_token, _external=True) }}">
              {{ url_for('public_playlist_view', token=p.share_token, _external=True) }}
            </a>
          </div>
        {% endif %}
      </div>

      <div class="shrink-0 flex items-center gap-2">
        {% if not p.share_token %}
          <!-- ปุ่มสร้างลิงก์แชร์ (ต้องมี route ensure_share_token) -->
          <form action="{{ url_for('playlist_share_enable', playlist_id=p.id) }}" method="post">
            <button class="rounded-xl border border-white/10 px-3 py-2 text-sm hover:bg-white/10">
              แชร์
            </button>
          </form>
        {% endif %}
        <a class="rounded-xl bg-emerald-500 px-3 py-2 text-sm hover:bg-emerald-400"
           href="{{ url_for('playlist_detail', playlist_id=p.id) }}">
          ดู
        </a>
      </div>
    </li>
    {% endfor %}
  </ul>
{% else %}
  <p class="text-white/60 mt-5">ยังไม่มีเพลย์ลิสต์</p>
{% endif %}

{% endblock %}
